# Информация о работе 3D-аватаров в Tavus Santa Demo

## Как работает 3D-аватар

### 1. Откуда берётся видео
- При клике «Start Conversation» фронтенд вызывает `createConversation(token)` (файл `src/api/createConversation.ts`).
- В ответ приложение получает объект с `conversation_id` и `conversation_url`.
- По этому URL устанавливается WebRTC-соединение через библиотеку `@daily-co/daily-react`.
- Сеанс устанавливается для двух участников:
  - вы (локальный участник)
  - «Санта-бот» (удалённый участник), который подключается с сервера Tavus CVI

### 2. Как видео «оживляется»
На сервере Tavus CVI работает конвейер:
1. Пользовательский аудиопоток поступает через WebRTC
2. Модуль turn-taking (Sparrow) определяет, когда вы закончили говорить
3. STT-движок транскрибирует речь в текст
4. LLM (Tavus-оптимизированный Llama-вариант) генерирует ответ
5. TTS-движок синтезирует аудио
6. Модель рендеринга лица (Phoenix) с движком синхронизации губ (Hummingbird) накладывает мимику
7. Готовое видео стримится обратно как WebRTC-поток

### 3. Что происходит в диалоге
- После подключения клиент ждёт удалённого участника (`useParticipantIds({filter:"remote"})`)
- Когда участник появляется, включается микрофон (`daily.setLocalAudio(true)`)
- Голос пользователя передаётся на сервер, где обрабатывается через STT
- Когда определяется конец фразы, запускается генерация ответа и трансляция видео
- Клиент отображает видео через `<DailyVideo>` и воспроизводит аудио через `<DailyAudio>`

## Как поменять аватар

Чтобы сменить 3D-аватара, нужно заменить два параметра в `src/api/createConversation.ts`:

```javascript
body: JSON.stringify({
  // ID персоны — определяет поведение и голос
  persona_id: "p3bb4745d4f9",      // ← Замените на ваш новый Persona ID
  // ID реплики — определяет 3D-модель аватара
  replica_id: "r3fbe3834a3e",      // ← Замените на нужный Replica ID
  conversation_name: "Разговор с Сантой",
  conversational_context: "...",
  custom_greeting: "...",
  properties: { language: "russian" }
}),
```

### Параметры для замены:
- `persona_id` — отвечает за «личность» (поведение, голос, знания)
- `replica_id` — отвечает за визуальную модель (внешний вид аватара)

### Почему эти параметры:
- `persona_id` указывает, какой набор инструкций, систему «prompt» и базу знаний применять
- `replica_id` задаёт, какой 3D-моделью стримить видео

Эти ID можно получить через Tavus Platform или API запросы к Tavus. 